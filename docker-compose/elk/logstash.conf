input {
  tcp {
    port => 5000
    type => syslog
  }
  udp {
    port => 5000
    type => syslog
  }
}

filter {
    grok {
      match => { "message" => "%{SYSLOG5424PRI}%{CISCOTIMESTAMP:syslog_timestamp} kernel: DROP IN=%{NOTSPACE:in} OUT=(%{NOTSPACE:out})? MAC=(%{NOTSPACE:mac})? SRC=%{NOTSPACE:src} DST=%{NOTSPACE:dst} LEN=(%{NOTSPACE:len})? TOS=(%{NOTSPACE:tos})? PREC=(%{NOTSPACE:prec})? TTL=(%{NOTSPACE:ttl})? ID=(%{NOTSPACE:id})? PROTO=(%{NOTSPACE:proto})? SPT=(%{NOTSPACE:sourceport})? DPT=(%{NOTSPACE:destport})? SEQ=(%{NOTSPACE:seq})? ACK=(%{NOTSPACE:ack})? WINDOW=(    %{NOTSPACE:window})?(%{GREEDYDATA:eventvalue})?" }
      add_field => [ "received_at", "%{@timestamp}" ]
      add_field => [ "received_from", "%{host}" ]
    }
    date {
      match => [ "syslog_timestamp", "MMM  d HH:mm:ss", "MMM dd HH:mm:ss" ]
    }
}

output {
  elasticsearch { hosts => ["elasticsearch:9200"] }
  stdout { codec => rubydebug }
}
